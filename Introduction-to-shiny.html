<!DOCTYPE html>
<html>
<head>
  <title>Introduction to Shiny</title>

  <meta charset="utf-8">
  <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
  <meta http-equiv="X-UA-Compatible" content="chrome=1">
  <meta name="generator" content="pandoc" />



  <meta name="date" content="2015-05-23" />

  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <meta name="apple-mobile-web-app-capable" content="yes">

  <link rel="stylesheet" media="all" href="Introduction-to-shiny_files/ioslides-13.5.1/fonts/fonts.css">

  <link rel="stylesheet" media="all" href="Introduction-to-shiny_files/ioslides-13.5.1/theme/css/default.css">
  <link rel="stylesheet" media="only screen and (max-device-width: 480px)" href="Introduction-to-shiny_files/ioslides-13.5.1/theme/css/phone.css">

  <base target="_blank">

  <script type="text/javascript">
    var SLIDE_CONFIG = {
      // Slide settings
      settings: {
                title: 'Introduction to Shiny',
                        useBuilds: true,
        usePrettify: true,
        enableSlideAreas: true,
        enableTouch: true,
              },

      // Author information
      presenters: [
            {
        name:  'George &amp; Wush' ,
        company: '',
        gplus: '',
        twitter: '',
        www: '',
        github: ''
      },
            ]
    };
  </script>

  <style type="text/css">

    b, strong {
      font-weight: bold;
    }

    em {
      font-style: italic;
    }

    slides > slide {
      -webkit-transition: all 0.4s ease-in-out;
      -moz-transition: all 0.4s ease-in-out;
      -o-transition: all 0.4s ease-in-out;
      transition: all 0.4s ease-in-out;
    }

    .auto-fadein {
      -webkit-transition: opacity 0.6s ease-in;
      -webkit-transition-delay: 0.4s;
      -moz-transition: opacity 0.6s ease-in 0.4s;
      -o-transition: opacity 0.6s ease-in 0.4s;
      transition: opacity 0.6s ease-in 0.4s;
      opacity: 0;
    }

  </style>

  <link rel="stylesheet" href="css\dsp.css" type="text/css" />


</head>

<body style="opacity: 0">

<slides class="layout-widescreen">

  <slide class="title-slide segue nobackground">
        <!-- The content of this hgroup is replaced programmatically through the slide_config.json. -->
    <hgroup class="auto-fadein">
      <h1 data-config-title><!-- populated from slide_config.json --></h1>
      <h2 data-config-subtitle><!-- populated from slide_config.json --></h2>
      <p data-config-presenter><!-- populated from slide_config.json --></p>
            <p style="margin-top: 6px; margin-left: -2px;">2015-05-23</p>
          </hgroup>
  </slide>

<slide class=''><hgroup><h2>About Me</h2></hgroup><article  id="about-me">

<h3>

George Chao

</h3>

<div class="columns-2">
<ul>

<li>

清大統計所畢業

</li>

<li>

現任職於: 資料分析相關產品顧問

<li>

巨量資料分析平台、視覺化工具、資料倉儲

</li>

</li>

<li>

Taiwan R User Group 工作人員

</li>

<li>

相關產業經驗: 遊戲、EC、科技業

</li>

</ul>

<p></br> </br> </br> </br></p>

<img src="img/george.jpg" width="400px"></div>

</article></slide><slide class='segue dark nobackground'><hgroup class = 'auto-fadein'><h2>傢俬準備好</h2></hgroup><article >

<p><img src="img/dsp-page.png" style="display:none"/> <img src="img/dsp-front-cover.png" style="display:none"/></p>

</article></slide><slide class=''><hgroup><h2>環境安裝</h2></hgroup><article  class="flexbox vcenter">

<p>R 套件安裝</p>

<pre class = 'prettyprint lang-r'>install.packages(c(&quot;dplyr&quot;,&quot;ggplot2&quot;,&quot;shiny&quot;,&quot;devtools&quot;))
devtools::install_github(&#39;rstudio/shinyapps&#39;)</pre>

</article></slide><slide class='segue dark nobackground'><hgroup class = 'auto-fadein'><h2>shiny shiny little star</h2></hgroup><article  id="shiny-shiny-little-star">

</article></slide><slide class=''><hgroup><h2>甚麼是shiny ?</h2></hgroup><article  id="shiny">

<div class="columns-2">
<ul>
<li>一個基於R 語言的網頁應用框架

<ul>
<li>可以用R 快速製作網頁應用</li>
<li>利用近代網頁技術製作動態網頁</li>
<li>分析結果「會動了」</li>
</ul></li>
<li>由 RStudio 於 2012-11 年正式提出Beta版</li>
<li>目前於 2015-05 釋出 v0.11</li>
</ul></div>

</article></slide><slide class=''><hgroup><h2>學Shiny的好處是？</h2></hgroup><article  id="shiny">

<div class="columns-2">
<ul>
<li>目前R中互動式分析報表最簡單的工具

<ul>
<li>需要理解網頁應用的運作原理</li>
<li><strong>不需要</strong>理解撰寫網頁應用工具（HTML、CSS和Javascript)，但是若想要擴充Shiny，則需要會這些工具</li>
<li><strong>不需要</strong>改寫已經用R 撰寫的分析流程，但是若希望能提供流暢的使用者體驗，則需要適度的優化</li>
</ul></li>
<li>可以和現代的Javascript視覺化函式庫做整合

<ul>
<li><a href='http://blog.rstudio.org/2014/06/23/introducing-ggvis/' title=''>Introducing ggvis</a></li>
<li><a href='http://blog.rstudio.org/2014/12/18/htmlwidgets-javascript-data-visualization-for-r/' title=''>htmlwidgets: JavaScript data visualization for R</a></li>
</ul></li>
</ul></div>

</article></slide><slide class='segue dark nobackground'><hgroup class = 'auto-fadein'><h2>Shiny 概觀</h2></hgroup><article  id="shiny-">

</article></slide><slide class=''><hgroup><h2>網頁應用的運作原理</h2></hgroup><article  class="flexbox vcenter">

<ul>
<li>客戶端：

<ul>
<li>瀏覽器進行畫面的呈現</li>
<li>瀏覽器和使用者進行互動

<ul>
<li>依據互動的過程，瀏覽器隨時會和伺服器交換資料

<ul>
<li>瀏覽器發出<em>Request</em></li>
<li>伺服器回傳<em>Response</em></li>
</ul></li>
</ul></li>
</ul></li>
<li>伺服器端：

<ul>
<li>伺服器提供畫面的規格給瀏覽器</li>
<li>伺服器再依據瀏覽器提供的資訊，回傳使用者需要的資料</li>
</ul></li>
</ul>

</article></slide><slide class=''><hgroup><h2>Shiny的運作原理</h2></hgroup><article  id="shiny">

<ul>
<li>基本架構

<ul>
<li><code>ui.R</code>: 客戶端，負責前端使用者介面的呈現</li>
<li><code>server.R</code>: 伺服器端，負責後端資料處理與計算</li>
</ul></li>
</ul>

<div class="columns-2">
<img src='img/interactive-1.png' title=''/>

<img src='img/interactive-2.png' title=''/></div>

</article></slide><slide class=''><hgroup><h2>Shiny - 客戶端輸入：<code>ui.R</code></h2></hgroup><article  id="shiny---ui.r">

<ul>
<li>shiny 會將 <code>ui.R</code>的R 物件轉換為HTML、CSS和Javascript，透過瀏覽器呈現</li>
<li>透過Javascript，瀏覽器會將使用者的動作轉換為Request發回給Server</li>
</ul>

<pre class = 'prettyprint lang-r'>inputPanel(
  selectInput(&quot;n_breaks&quot;, label = &quot;Number of bins:&quot;,
              choices = c(10, 20, 35, 50), selected = 20)
)</pre>

</article></slide><slide class=''><hgroup><h2>Shiny - 伺服器端：<code>server.R</code></h2></hgroup><article  id="shiny---server.r">

<ul>
<li>Shiny server處理瀏覽器傳來的Request，轉化為R 中的<code>input</code></li>
<li>我們撰寫R 函數將<code>input</code>轉換為<code>output</code></li>
<li>Shiny server再把<code>output</code>轉換為<code>Response</code>傳回瀏覽器</li>
</ul>

<pre class = 'prettyprint lang-r'>function(input, output) {
  output$plot &lt;- renderPlot({
    hist(faithful$eruptions, probability = TRUE, breaks = as.numeric(input$n_breaks),
         xlab = &quot;Duration (minutes)&quot;, main = &quot;Geyser eruption duration&quot;)
    
    dens &lt;- density(faithful$eruptions, adjust = 1)
    lines(dens, col = &quot;blue&quot;)
  })
}</pre>

</article></slide><slide class=''><hgroup><h2>Shiny - 客戶端輸出：<code>ui.R</code></h2></hgroup><article  id="shiny---ui.r">

<ul>
<li>透過Javascript，瀏覽器會將Server回傳的<code>Response</code>呈現在瀏覽器上</li>
</ul>

<pre class = 'prettyprint lang-r'>print(plotOutput(&quot;plot&quot;))</pre>

<pre >&lt;div id=&quot;plot&quot; class=&quot;shiny-plot-output&quot; style=&quot;width: 100% ; height: 400px&quot;&gt;&lt;/div&gt; </pre>

</article></slide><slide class='segue dark nobackground'><hgroup class = 'auto-fadein'><h2>Hello shiny</h2></hgroup><article  id="hello-shiny">

</article></slide><slide class=''><hgroup><h2>如何執行 shiny apps</h2></hgroup><article  id="-shiny-apps">

<p>學習shiny，先從範例模仿</p>

<ol>
<li>從Rstudio建立shiny apps:

<ul>
<li>step1 Create Project<br/></li>
<li>step2 選 Shiny Web Application<br/></li>
<li>step3 檔案目錄代表app名稱<br/></li>
</ul></li>
<li>載入已建立好的apps(即目錄名稱)</li>
<li><code>runApp</code></li>
</ol>

</article></slide><slide class=''><hgroup><h2>小挑戰 1 &#8211; Run App</h2></hgroup><article  id="-1----run-app">

<ul>
<li>依照前述的操作，建立一個Shiny App，名叫：DSPShinyCourse</li>
</ul>

<p><strong>HINT</strong></p>

<pre >從Rstudio建立shiny apps: 
    step1 Create Project   
    step2 選 Shiny Web Application   
    step3 檔案目錄代表app名稱     </pre>

</article></slide><slide class=''><hgroup><h2>我們來看看預設的<code>ui.R</code></h2></hgroup><article  id="ui.r">

<ul>
<li><code>library(shiny)</code>載入shiny套件</li>
<li><code>shinyUI</code>：它之中的物件都是shiny UI物件</li>
<li><code>fluidPage</code>：整個瀏覽器頁面的容器</li>
<li><code>titlePanel</code>、<code>sidebarPanel</code>和<code>mainPanel</code></li>
</ul>

<pre class = 'prettyprint lang-r'>library(shiny)
shinyUI(fluidPage(
  titlePanel(title=&quot;Hello Shiny&quot;)
  sidebarPanel(
    sliderInput(inputId=&quot;bins&quot;,
                 label=&quot;Number of bins:&quot;,
                 min = 1,max = 50,value = 30))
  mainPanel(plotOutput(outputId=&quot;distPlot&quot;))
))</pre>

</article></slide><slide class=''><hgroup><h2>程式碼的物件如何呈現於瀏覽器中?</h2></hgroup><article >

<div class="columns-2">
<p><img src="img/ui.R-new1.jpg" style='max-width: 100%;max-height:100%'></p>

<img src="img/ui.R-new2.jpg" style='max-width: 100%;max-height:100%'></div>

</article></slide><slide class=''><hgroup><h2>shiny UI物件的結構-1</h2></hgroup><article  id="shiny-ui-1">

<ul>
<li>shiny UI物件會轉換為HTML，而HTML是一個結構化語言</li>
<li>shiny UI物件的結構對應到HTML的結構</li>
</ul>

<pre class = 'prettyprint lang-r'>print(fluidPage())
print(titlePanel(title = &quot;Test Title&quot;))
print(fluidPage(titlePanel(title = &quot;Test Title&quot;)))</pre>

</article></slide><slide class=''><hgroup><h2>shiny UI物件的結構-2</h2></hgroup><article  id="shiny-ui-2">

<ul>
<li>每個shiny UI的物件，是以一對<code>(</code>和<code>)</code>為單位</li>
</ul>

<pre class = 'prettyprint lang-r'>print(fluidPage(titlePanel(title = &quot;Test Title&quot;)))</pre>

<ul>
<li><code>titlePanel(title = &quot;Test Title&quot;)</code></li>
<li><code>fluidPage(titlePanel(...))</code></li>
</ul>

</article></slide><slide class=''><hgroup><h2>shiny UI物件的結構-3</h2></hgroup><article  id="shiny-ui-3">

<ul>
<li>shiny UI物件的結構，可以轉換為一個樹狀結構</li>
</ul>

<pre class = 'prettyprint lang-r'>print(fluidPage(titlePanel(title = &quot;Test Title&quot;)))</pre>

<pre >fluidPage &lt;-- titlePanel</pre>

</article></slide><slide class=''><hgroup><h2>shiny UI物件的結構-4</h2></hgroup><article  id="shiny-ui-4">

<p><code>小思考</code>:請問預設ui.R中的結構為何?</p>

<pre class = 'prettyprint lang-r'>fluidPage(
  titlePanel(...)
  sidebarPanel(sliderInput(...))
  mainPanel(plotOutput(...))
)</pre>

<pre >fluidPage &lt;--- titlePanel
            |- sidebarPanel &lt;--- sliderInput
            |- mainPanel &lt;--- plotOutput</pre>

</article></slide><slide class=''><hgroup><h2>shiny UI物件的參數</h2></hgroup><article  id="shiny-ui">

<ul>
<li>shiny UI物件的參數會影響到產生的HTML的語法，進而在瀏覽器造成不同的呈現結果</li>
</ul>

<pre class = 'prettyprint lang-r'>titlePanel(title = &quot;Test Title 1&quot;)
titlePanel(title = &quot;Test Title 2&quot;)</pre>

</article></slide><slide class=''><hgroup><h2>Hello Shiny的<code>ui.R</code>中shiny UI物件的功能與常用參數</h2></hgroup><article  id="hello-shinyui.rshiny-ui">

<ul>
<li><code>titlePanel</code> 產生標題

<ul>
<li><code>title</code>：頁面的標題</li>
</ul></li>
<li><code>sidebarPanel</code> 頁面左區塊的容器

<ul>
<li>參數是其他shiny UI物件</li>
</ul></li>
<li><code>sliderInput</code> 使用者可以拉動的Bar

<ul>
<li><code>inputId</code>：產生的Request物件的欄位（和server.R有關）</li>
<li><code>label</code>：顯示在瀏覽器上的說明文字</li>
<li><code>min</code>：Bar的最小值</li>
<li><code>max</code>：Bar的最大值</li>
<li><code>value</code>：預設值</li>
<li><code>step</code>：使用者滑動Bar的最小單位（不給的話，Shiny會自動決定）</li>
</ul></li>
</ul>

</article></slide><slide class=''><hgroup><h2>Hello Shiny的<code>ui.R</code>中shiny物件的功能與常用參數</h2></hgroup><article  id="hello-shinyui.rshiny">

<ul>
<li><code>mainPanel</code> 頁面右方區塊的容器

<ul>
<li>參數是其他shiny UI物件</li>
</ul></li>
<li><code>plotOutput</code> 呈現來自伺服器的圖形輸出

<ul>
<li><code>outputId</code>：對應的Response物件的欄位（和server.R有關）</li>
<li><code>width</code>：寬度</li>
<li><code>height</code>：高度</li>
</ul></li>
</ul>

</article></slide><slide class=''><hgroup><h2>小挑戰 2 &#8211; 更改title</h2></hgroup><article  id="-2----title">

<ul>
<li>點下Run App來瀏覽Shiny Application</li>
<li>關閉產生的視窗</li>
<li>修改<code>ui.R</code>中<code>titlePanel</code>的值</li>
<li>點下Run App來看title是否有更動</li>
</ul>

</article></slide><slide class=''><hgroup><h2>小挑戰 3 &#8211; 更改結構</h2></hgroup><article  id="-3----">

<ul>
<li>繼續使用DSPShinyCourse</li>
<li>修改<code>ui.R</code>

<ul>
<li>把整段<code>sliderInput</code>的程式碼從<code>sidebarPanel</code>剪下貼上到<code>mainPanel</code>之中</li>
<li>點下Run App</li>
</ul></li>
<li><p>如果對R 語言不是很熟悉的同學，可能會遇到以下錯誤：</p>

<pre >ERROR: /home/wush/Project/DSPShinyCourse/ui.R:28:7: unexpected symbol
27:                   value = 30)
28:       plotOutput</pre></li>
<li>觀察<code>sliderInput</code>位置的改變

<ul>
<li>理解兩種容器：<code>sidebarPanel</code>和<code>mainPanel</code>的位置與用途</li>
</ul></li>
</ul>

</article></slide><slide class=''><hgroup><h2>Hello Shiny的<code>server.R</code></h2></hgroup><article  id="hello-shinyserver.r">

<ul>
<li><code>library(shiny)</code>載入Shiny</li>
<li><code>shinyServer</code>：定義伺服器端的邏輯</li>
<li><code>function(input, output) {...}</code>:一段自Request產生Response的邏輯</li>
</ul>

<pre class = 'prettyprint lang-r'>library(shiny)
shinyServer(function(input, output) {
  output$distPlot &lt;- renderPlot({
    # generate bins based on input$bins from ui.R
    x    &lt;- faithful[, 2]
    bins &lt;- seq(min(x), max(x), length.out = input$bins + 1)
    # draw the histogram with the specified number of bins
    hist(x, breaks = bins, col = &#39;darkgray&#39;, border = &#39;white&#39;)
  })
})</pre>

</article></slide><slide class=''><hgroup><h2>Hello Shiny：伺服器端的邏輯</h2></hgroup><article  id="hello-shiny">

<ul>
<li><code>input</code>：Request物件，攜帶所有在<code>ui.R</code>中<code>xxxInput</code>物件的值

<ul>
<li><code>input$bins</code>對應到<code>sliderInput(inputId=&quot;bins&quot;, ...)</code></li>
</ul></li>
<li><code>output</code>：Response物件，輸出至<code>ui.R</code>中<code>xxxOutput</code>物件 <code>output$distPlot</code>會對應到<code>plotOutput(outputId=&quot;distPlot&quot;)</code></li>
</ul>

<pre class = 'prettyprint lang-r'>function(input, output) {
  output$distPlot &lt;- renderPlot({
    ...
    bins &lt;- seq(min(x), max(x), length.out = input$bins + 1)
    ...
  })
}</pre>

</article></slide><slide class=''><hgroup><h2>小挑戰 4-1 &#8211; 理解input和ui.R之間的對應</h2></hgroup><article  id="-4-1----inputui.r">

<ul>
<li>繼續使用DSPShinyCourse</li>
<li>修改<code>ui.R</code>

<ul>
<li>將<code>sliderInput</code>的第一個參數從<code>&quot;bins&quot;</code>改成<code>&quot;binss&quot;</code></li>
<li>存檔</li>
</ul></li>
<li>執行（Run App）

<ul>
<li>觀察頁面有無產生</li>
<li>觀察頁面上的錯誤</li>
</ul></li>
</ul>

</article></slide><slide class=''><hgroup><h2>小挑戰 4-2 &#8211; 理解input和ui.R之間的對應，練習browser除錯技巧</h2></hgroup><article  id="-4-2----inputui.rbrowser">

<ul>
<li>修改<code>server.R</code>

<ul>
<li><p>在<code>output$distPlot</code>之中插入一行程式碼，變成：</p>

<pre class = 'prettyprint lang-r'>x    &lt;- faithful[, 2]
browser()
bins &lt;- seq(min(x), max(x), length.out = input$bins + 1)</pre></li>
</ul></li>
<li>執行，但是會中斷在<code>browser()</code>這行

<ul>
<li>觀察頁面有無產生</li>
<li>觀察<code>input$bins</code>的值</li>
<li>直接跑<code>bins &lt;- seq(min(x), max(x), length.out = input$bins + 1)</code>，觀察錯誤訊息</li>
</ul></li>
</ul>

</article></slide><slide class=''><hgroup><h2>小挑戰 4-3 &#8211; 理解input和ui.R之間的對應</h2></hgroup><article  id="-4-3----inputui.r">

<ul>
<li>修改<code>server.R</code>

<ul>
<li>移除<code>browser()</code></li>
<li>將<code>sliderInput</code>的第一個參數從<code>&quot;bins&quot;</code>改成<code>&quot;binss&quot;</code></li>
<li>存檔</li>
</ul></li>
<li>執行</li>
</ul>

</article></slide><slide class=''><hgroup><h2>Hello Shiny：建立Response物件</h2></hgroup><article  id="hello-shinyresponse">

<ul>
<li><code>output$distPlot</code>建立Response物件中的<code>distPlot</code>

<ul>
<li><code>ui.R</code>中的<code>plotOutput(&quot;distPlot&quot;)</code>將<code>output$distPlot</code>呈現於瀏覽器之中</li>
</ul></li>
<li><code>renderXXX</code>會將<code>{...}</code>的結果轉換為Response物件

<ul>
<li><code>renderXXX</code>和<code>xxxOutput</code>必須有正確的對應：

<ul>
<li><code>renderPlot</code> &lt;&#8211;&gt; <code>plotOutput</code></li>
<li><code>renderTable</code>或 <code>renderDataTable</code> &lt;&#8211;&gt; <code>tableOutput</code>或<code>dataTableOutput</code></li>
<li><code>renderText</code> &lt;&#8211;&gt; <code>textOutput</code></li>
</ul></li>
</ul></li>
</ul>

<pre class = 'prettyprint lang-r'>output$distPlot &lt;- renderPlot({...})</pre>

</article></slide><slide class=''><hgroup><h2>Hello Shiny：renderPlot的運作原理</h2></hgroup><article  id="hello-shinyrenderplot">

<ul>
<li>最後必須要能輸出R 的圖形物件

<ul>
<li><code>hist(...)</code></li>
</ul></li>
<li>Reactive：Input導致Output有變動時，才會執行</li>
</ul>

<pre class = 'prettyprint lang-r'>  output$distPlot &lt;- renderPlot({
    # generate bins based on input$bins from ui.R
    x    &lt;- faithful[, 2]
    bins &lt;- seq(min(x), max(x), length.out = input$binss + 1)
    # draw the histogram with the specified number of bins
    hist(x, breaks = bins, col = &#39;darkgray&#39;, border = &#39;white&#39;)</pre>

</article></slide><slide class=''><hgroup><h2>小挑戰 5-1 &#8211; 觀察Reactive和Input的關係</h2></hgroup><article  id="-5-1----reactiveinput">

<ul>
<li>繼續使用APP:DSPShinyCourse</li>
<li>修改<code>server.R</code>

<ul>
<li><p>在<code>output$distPlot</code>之中修改，變成：</p>

<pre class = 'prettyprint lang-r'>x    &lt;- faithful[, 2]
browser()
bins &lt;- seq(min(x), max(x), length.out = input$bins + 1)</pre></li>
</ul></li>
<li>執行，但是會中斷在<code>browser()</code>這行

<ul>
<li>按下c 繼續執行</li>
</ul></li>
<li>在UI上進行操作，改變Numbers of bins

<ul>
<li>是否每次改變都會中斷？</li>
</ul></li>
</ul>

</article></slide><slide class=''><hgroup><h2>小挑戰 5-2 - 觀察Reactive和Input的關係</h2></hgroup><article  id="-5-2---reactiveinput">

<ul>
<li>修改<code>server.R</code>

<ul>
<li><p>在<code>output$distPlot</code>之中修改，變成：（renderPlot不再用到<code>input$bins</code>資訊）</p>

<pre class = 'prettyprint lang-r'>x    &lt;- faithful[, 2]
browser()
bins &lt;- seq(min(x), max(x), length.out = 26)</pre></li>
</ul></li>
<li>執行，但是會中斷在<code>browser()</code>這行

<ul>
<li>按下c 繼續執行</li>
</ul></li>
<li>在UI上進行操作，改變Numbers of bins

<ul>
<li>是否每次改變都會中斷？</li>
</ul></li>
</ul>

</article></slide><slide class=''><hgroup><h2>Hello Shiny : <code>server.R</code>運作原理</h2></hgroup><article  id="hello-shiny-server.r">

<p>觀察<code>server.R</code>程式架構<br/>- 最外層: 環境設定 -&gt; 第一層:<code>function(input,output)</code> -&gt; 第二層: <code>renderXXX</code></p>

<pre >shinyServer &lt;--- function(input,output)
            |- output$&lt;plotName&gt; &lt;--- renderPlot</pre>

<pre class = 'prettyprint lang-r'>library(shiny)
#### 最外層位置: Run once #### 
shinyServer(function(input, output){
  #### 第一層: Run by user ####
  output$distPlot &lt;- renderPlot({
    #### 第二層: Run often ####
    x    &lt;- faithful[, 2]  # Old Faithful Geyser data
    bins &lt;- seq(min(x), max(x), length.out = input$bins + 1)
    hist(x, breaks = bins, col = &#39;darkgray&#39;, border = &#39;white&#39;)
  })
})</pre>

</article></slide><slide class=''><hgroup><h2>小挑戰 6 &#8211; 觀察session的運作</h2></hgroup><article  id="-6----session">

<ul>
<li>利用global變數和 <code>&lt;&lt;-</code> 來計算<code>server.R</code>的運作次數</li>
<li>並透過<code>cat</code>將結果顯示出來</li>
<li>試問如果多次開啟browser有甚麼發現嗎?</li>
</ul>

<p><strong>HINT</strong> 可以嘗試如下列程式碼新增</p>

<pre class = 'prettyprint lang-r'>library(shiny)
layer1 &lt;&lt;- layer2 &lt;&lt;- layer3 &lt;&lt;- 0  ################################### 新增此行
layer1 &lt;&lt;- layer1 + 1       ########################################### 新增此行
shinyServer(function(input, output){
  layer2 &lt;&lt;- layer2 + 1     ########################################### 新增此行
  output$distPlot &lt;- renderPlot({
    layer3 &lt;&lt;- layer3 + 1   ########################################### 新增此行
    x    &lt;- faithful[, 2]
    bins &lt;- seq(min(x), max(x), length.out = input$bins + 1)
    hist(x, breaks = bins, col = &#39;darkgray&#39;, border = &#39;white&#39;)
    cat(&quot;layer1 = &quot;,layer1,&quot;layer2 = &quot;,layer2,&quot;layer3 =&quot;,layer3,&quot;\n&quot;) # 新增此行
  })
})</pre>

</article></slide><slide class=''><hgroup><h2>Panel to Page</h2></hgroup><article  id="panel-to-page">

<p>如此一來就完成了</p>

<div class="code_block">
</div>

</article></slide><slide class='segue dark nobackground'><hgroup class = 'auto-fadein'><h2>實務 Shiny 技巧</h2></hgroup><article  id="-shiny-">

</article></slide><slide class=''><hgroup><h2>資料匯入</h2></hgroup><article >

<p>讀取ubike資料檔案</p>

<ol>
<li>下載以下資料檔

<ul>
<li><code>windows</code> 選 <a href='https://dl.dropboxusercontent.com/u/68133220/DSP/ubikeweather_big5.rda' title=''><code>ubikeweather_big5.rda</code></a></li>
<li><code>Mac</code> 選 <a href='https://dl.dropboxusercontent.com/u/68133220/DSP/ubikeweather_utf8.rda' title=''><code>ubikeweather_utf8.rda</code></a>

<ul>
<li><a href='https://dl.dropboxusercontent.com/u/68133220/DSP/ubikeweather_utf8.tgz' title=''>較小的連結</a></li>
</ul></li>
</ul></li>
<li>將R資料檔案格式，存在目錄<code>data</code>下面，<code>&lt;file_name&gt;.rda</code>檔，日後方便shiny app讀取</li>
</ol>

<pre class = 'prettyprint lang-r'>dir.create(&quot;data&quot;)
if (.Platform$OS.type == &quot;windows&quot;) load(&quot;data/ubikeweather_big5.rda&quot;) else
  load(&quot;data/ubikeweather_utf8.rda&quot;)</pre>

</article></slide><slide class=''><hgroup><h2>小挑戰 7 &#8211; 修改資料來源</h2></hgroup><article  id="-7----">

<p>將Hello Shiny改為自己的App，並將資料改為用<code>ubike</code>與計算最大空位數(``)的直方圖</p>

<p><strong>HINT</strong><br/>- 利用上述 <strong>Hello Shiny</strong> 程式碼分別建立<strong>ui.R</strong>,<strong>server.R</strong>於<strong>DSPShinyCourse</strong>目錄下<br/>- 讀取資料放置最外層<code>load(&quot;data/ubikeweather_&lt;utf8/big5&gt;.rda&quot;)</code><br/>- 將 <code>faithful[, 2]</code> 換成 <code>ubike[,&#39;max.bemp&#39;]</code><br/>- 建立完後按下右上角，<strong>Run App</strong></p>

</article></slide><slide class=''><hgroup><h2>Answer</h2></hgroup><article  id="answer">

<div class="code_block">
<pre class = 'prettyprint lang-r'>########
# ui.R #
########
library(shiny)
if (.Platform$OS.type == &quot;windows&quot;) load(&quot;data/ubikeweather_big5.rda&quot;) else
  load(&quot;data/ubikeweather_utf8.rda&quot;) ########################## 新增此行
shinyUI(fluidPage(
  titlePanel(title=&quot;Hello Shiny&quot;),
  sidebarPanel(
    sliderInput(inputId=&quot;bins&quot;,
                 label=&quot;Number of bins:&quot;,
                 min = 1,max = 50,value = 30)),
  mainPanel(plotOutput(outputId=&quot;distPlot&quot;))
))
############
# server.R #
############
library(shiny)
if (.Platform$OS.type == &quot;windows&quot;) load(&quot;data/ubikeweather_big5.rda&quot;) else
  load(&quot;data/ubikeweather_utf8.rda&quot;) ########################## 新增此行
shinyServer(function(input, output) { 
  output$distPlot &lt;- renderPlot({
    x    &lt;- ubike[, &#39;max.bemp&#39;]  ########################## 更改此行
    bins &lt;- seq(min(x), max(x), length.out = input$bins + 1)
    hist(x, breaks = bins, col = &#39;darkgray&#39;, border = &#39;white&#39;)
  })
})</pre></div>

</article></slide><slide class=''><hgroup><h2>資料表呈現</h2></hgroup><article >

<ul>
<li>資料採用<code>ggplot2</code>中<code>diamonds</code>作為範例</li>
<li>UI端: <code>renderTable</code> &lt;&#8211;&gt; Server端: <code>tableOutput</code>或<code>dataTableOutput</code></li>
</ul>

</article></slide><slide class=''><hgroup><h2>UI checkbox</h2></hgroup><article  id="ui-checkbox">

<ul>
<li><code>checkboxGroupInput</code>:勾選的tool bar

<ul>
<li><code>choices</code>: 將選項列出來</li>
<li><code>selected</code>: 預先勾好的內容</li>
</ul></li>
</ul>

<div class="code_block">
<pre class = 'prettyprint lang-r'>library(ggplot2)
inputPanel(checkboxGroupInput(inputId = &#39;show_vars&#39;, label =&#39; Columns in diamonds to show:&#39;,
                              choices = names(diamonds), selected = names(diamonds)))</pre></div>

</article></slide><slide class=''><hgroup><h2>dataTable code</h2></hgroup><article  id="datatable-code">

<ul>
<li><code>ui.R</code> 需要有 <code>dataTableOutput</code> 將Table HTML語法抓出</li>
<li><code>server.R</code> 需要有<code>renderDataTable</code> 將Table語法回傳</li>
<li>資料採用<code>ggplot2</code>中<code>diamonds</code>作為範例</li>
</ul>

<pre class = 'prettyprint lang-r'>dataTableOutput(`mytable`)
output$mytable &lt;- renderDataTable({...})</pre>

<div class="code_block">
<pre class = 'prettyprint lang-r'>#### ui.R ####################################
library(shiny);library(ggplot2)
shinyUI(fluidPage(
  titlePanel(&quot;Examples of DataTables&quot;),
  sidebarLayout(
    sidebarPanel(
      checkboxGroupInput(&#39;show_vars&#39;, &#39;Columns in diamonds to show:&#39;,
                           names(diamonds), selected = names(diamonds))
    ),
    mainPanel(
      dataTableOutput(&#39;mytable&#39;)
    )#mainPanel
  )#sidebarLayout
))#fluidPage,shinyUI
#### server.R ###############################
library(shiny);library(ggplot2)  
shinyServer(function(input, output) {
  # a large table, reative to input$show_vars
  output$mytable &lt;- renderDataTable({
    diamonds[, input$show_vars, drop = FALSE]
  })#renderDataTable
})#function,shinyServer</pre></div>

</article></slide><slide class=''><hgroup><h2>小挑戰 8 &#8211; dataTable</h2></hgroup><article  id="-8----datatable">

<ul>
<li>試作出ubike的dataTable，並將app取作<code>DSPShiny_dataTable</code></li>
</ul>

</article></slide><slide class=''><hgroup><h2>Answer (<code>ui.R</code>)</h2></hgroup><article  id="answer-ui.r">

<pre class = 'prettyprint lang-r'>library(shiny)
shinyUI(fluidPage(
  titlePanel(&quot;Examples of DataTables&quot;),
  sidebarLayout(
    sidebarPanel(
      checkboxGroupInput(&#39;show_vars&#39;, &#39;Columns in ubike to show:&#39;,
                           names(ubike), selected = names(ubike))########新增此行
    ),
    mainPanel(
      dataTableOutput(&#39;mytable&#39;)
    )#mainPanel
  )#sidebarLayout
))#fluidPage,shinyUI</pre>

</article></slide><slide class=''><hgroup><h2>Answer (<code>server.R</code>)</h2></hgroup><article  id="answer-server.r">

<pre class = 'prettyprint lang-r'>library(shiny)
shinyServer(function(input, output) {
  # a large table, reative to input$show_vars
  output$mytable &lt;- renderDataTable({
    diamonds[, input$show_vars, drop = FALSE]
  })#renderDataTable
})#function,shinyServer</pre>

</article></slide><slide class=''><hgroup><h2>動態圖形 barplot</h2></hgroup><article  id="-barplot">

</article></slide><slide class=''><hgroup><h2>繪製圖形 &#8211; barplot</h2></hgroup><article  id="----barplot">

<ul>
<li><code>reorder(factor_a,vector_b,FUN=mean)</code>: 不同淨度與其他組合價格排序不同</li>
<li><code>stat=identity</code>: 針對y個別值直接累計</li>
</ul>

<div class="code_block">
<pre class = 'prettyprint lang-r'>library(ggplot2);library(dplyr)
d.p &lt;- ggplot(data = filter(diamonds,cut == &quot;Good&quot;), 
              aes(x = reorder(clarity, -price), y = price, colour = clarity, fill = clarity)) 
d.p + geom_bar(stat=&quot;identity&quot;) + coord_flip()</pre></div>

</article></slide><slide class=''><hgroup><h2><code>server.R</code> 互動元件</h2></hgroup><article  id="server.r-">

<table class = 'rmdtable'>
<tr class="header">
<th align="left">ui.R</th>
<th align="left">server.R</th>
</tr>
<tr class="odd">
<td align="left">plotOutput</td>
<td align="left">renderPlot</td>
</tr>
<tr class="even">
<td align="left">tableOutput</td>
<td align="left">renderTable</td>
</tr>
<tr class="odd">
<td align="left">dataTableOutput</td>
<td align="left">renderDataTable</td>
</tr>
</table>

<div class="code_block">
<pre class = 'prettyprint lang-r'>library(dplyr);library(ggplot2)
inputPanel(selectInput(inputId=&#39;cut&#39;, label=&#39;cut&#39;, levels(diamonds$cut)))
renderTable(head(filter(diamonds,cut == &quot;Good&quot;)))</pre></div>

</article></slide><slide class=''><hgroup><h2>小挑戰 9 &#8211; barplot</h2></hgroup><article  id="-9----barplot">

<p>試製作barplot互動圖形，並將資料換成ubike，選取的選單為行政區(<code>sarea</code>)</p>

</article></slide><slide class=''><hgroup><h2>Answer (ui.R)</h2></hgroup><article  id="answer-ui.r-1">

<pre class = 'prettyprint lang-r'>library(shiny);library(ggplot2);library(dplyr)
load(&quot;../../data/ubikeweather_big5.rda&quot;)
shinyUI(fluidPage(
    titlePanel(&quot;barplot Example&quot;),
    sidebarPanel(
      selectInput(inputId=&#39;District&#39;, label=&#39;district&#39;, choices=unique(ubike$sarea))
      ),
    mainPanel(plotOutput(outputId=&quot;plot1&quot;))
))</pre>

</article></slide><slide class=''><hgroup><h2>Answer (server.R)</h2></hgroup><article  id="answer-server.r-1">

<pre class = 'prettyprint lang-r'>library(shiny);library(ggplot2);library(dplyr)
load(&quot;../../data/ubikeweather_big5.rda&quot;)
shinyServer(function(input, output) { 
    output$plot1 &lt;- renderPlot({
      bike.p &lt;- ggplot(data = filter(ubike,sarea == input$District), 
                       aes(x = reorder(sna, -avg.bemp), y = avg.bemp, colour = sna, fill = sna))
      bike.p + geom_bar(stat=&quot;identity&quot;) + coord_flip()
    })
})</pre>

</article></slide><slide class=''><hgroup><h2>頁面整合 &#8211; navbarPage + navlistPanel</h2></hgroup><article  id="----navbarpage-navlistpanel">

將各種結果放置sidebar區域點選

<div class="code_block">
<pre >navbarPage &lt;--- tabPaenl  
           |- navlistPaenl &lt;- tabPanel</pre></div>

</article></slide><slide class=''><hgroup><h2>頁面整合 navbarPage + tabsetPanel</h2></hgroup><article  id="-navbarpage-tabsetpanel">

將結果放置在mainPanel中，點選tabs

<div class="code_block">
<pre >navbarPage &lt;--- tabPaenl  
           |- tabsetPaenl &lt;- tabPanel</pre></div>

</article></slide><slide class=''><hgroup><h2>Useful Layout</h2></hgroup><article  id="useful-layout" class="flexbox vcenter">

<p><img src="img/Useful-Layout.png" style='max-width: 100%;max-height: 110%'></p>

</article></slide><slide class=''><hgroup><h2>當Panel 與 Page不夠用時的好選擇</h2></hgroup><article  id="panel--page">

<p><code>xxxPanel(title,output)</code>: ex <code>navlistPanel(&quot;navlist&quot;,plotOutput())</code></p>

<ul>
<li><code>navbarPage()</code>: 可以置放很多<code>tabPanel</code>在最上層(Top-Level)<br/></li>
<li><code>navlistPanel()</code>: 可以置放很多<code>tabPanel</code>在左邊控制區域(sidebar)<br/></li>
<li><code>tabsetPanel()</code>: 可以放置很多<code>tabPanle</code>在畫圖等呈現區域(mainPanel)</li>
</ul>

<div class="code_block">
<pre class = 'prettyprint lang-r'>navbarPage(&quot;NavbarPage Name&quot;,
  tabPanel(&quot;TabPanel1&quot;,
    selectInput(inputId=&#39;cut&#39;, label=&#39;cut&#39;, levels(diamonds$cut)),
    navlistPanel(&quot;NavlistPanel Name&quot;,
      tabPanel(&quot;component1&quot;),
      tabPanel(&quot;component2&quot;)
    )#navlistPanel
  ),#tabPanel:Tab1
  tabPanel(&quot;TabPanel2&quot;)
)#navbarPage</pre>

<br/> <br/> <br/><br/></div>

</article></slide><slide class=''><hgroup><h2>當Panel 與 Page不夠用時的好選擇</h2></hgroup><article  id="panel--page-1">

<ul>
<li><code>navbarPage()</code>: 可以置放很多<code>tabPanel</code>在最上層(Top-Level)<br/></li>
<li><code>navlistPanel()</code>: 可以置放很多<code>tabPanel</code>在左邊控制區域(sidebar)<br/></li>
<li><code>tabsetPanel()</code>: 可以放置很多<code>tabPanle</code>在畫圖等呈現區域(mainPanel)</li>
</ul>

<div class="code_block">
<pre class = 'prettyprint lang-r'>navbarPage(&quot;NavbarPage Name&quot;,
  tabPanel(&quot;TabPanel1&quot;,
    sidebarLayout(
      sidebarPanel(
        selectInput(inputId=&#39;cut&#39;, label=&#39;cut&#39;, levels(diamonds$cut))
      ),#sidebarPaenl
      mainPanel(
        tabsetPanel(
          tabPanel(&quot;tab1&quot;),
          tabPanel(&quot;tab2&quot;)
        )#tabsetPanel
      )#mainPanel
    )#sidebarLayout
  ),#tabPanel:Tab1
  tabPanel(&quot;TabPanel2&quot;)
)#navbarPage</pre>

<br/> <br/> <br/> <br/></div>

</article></slide><slide class=''><hgroup><h2>小挑戰 10 &#8211; navbarPage</h2></hgroup><article  id="-10----navbarpage">

<p>Q: 練習將uike的兩個app，barplot與dataTable製作成同個頁面navlistpanel的components</p>

</article></slide><slide class=''><hgroup><h2>answer (ui.R)</h2></hgroup><article  id="answer-ui.r-2">

<div class="code_block">
<pre class = 'prettyprint lang-r'>library(shiny);library(ggplot2);library(dplyr)
load(&quot;../../data/ubikeweather_big5.rda&quot;)
shinyUI(navbarPage(&quot;&quot;,
  titlePanel(&quot;Navlist panel example&quot;),
  navlistPanel(&quot;header&quot;,
     selectInput(inputId=&#39;District&#39;, label=&#39;district&#39;, choices=unique(ubike$sarea))
      tabPanel(&quot;First&quot;,plotOutput(&#39;plot1&#39;)),
      tabPanel(&quot;Second&quot;,dataTableOutput(outputId=&quot;table&quot;))
  )
))</pre></div>

</article></slide><slide class=''><hgroup><h2>answer (server.R)</h2></hgroup><article  id="answer-server.r-2">

<div fill="sna))" class="colde-block&gt; ```r library(shiny);library(ggplot2);library(dplyr) load(" ggplot(data="filter(ubike," sarea="=" y="avg.bemp," geom_bar(stat="identity" colour="sna," aes(x="reorder(sna,">
<pre class = 'prettyprint lang-r'>library(shiny);library(ggplot2);library(dplyr)
load(&quot;../../data/ubikeweather_big5.rda&quot;)
shinyServer(function(input, output) {
    output$plot1 &lt;- renderPlot({
      bike.p &lt;- ggplot(data = filter(ubike, sarea == input$District), 
                     aes(x = reorder(sna, -avg.bemp), y = avg.bemp, colour = sna, fill = sna))
    bike.p + geom_bar(stat=&quot;identity&quot;) + coord_flip()
      })
    output$table &lt;- renderDataTable(filter(ubike, sarea == input$District))  
})</pre></div>

</article></slide><slide class='segue dark nobackground'><hgroup class = 'auto-fadein'><h2>期末成發</h2></hgroup><article >

</article></slide><slide class=''><hgroup><h2><a href='https://www.shinyapps.io/' title=''>shinyapps(v0.3.64)</a></h2></hgroup><article  id="shinyappsv0.3.64">

<ul>
<li><a href='http://shiny.rstudio.com/articles/shinyapps.html' title=''>Getting started with shinyapps.io</a></li>
<li>Platform as a service for hosting shiny web apps

<ol>
<li>Windows users: Rtools<br/></li>
<li>Mac users: XCode Command Line Tools<br/></li>
<li>Linux users: GCC<br/></li>
</ol></li>
<li>The latest version of the <a href='https://github.com/rstudio/shinyapps' title=''>shinyapps</a> R package</li>
<li>Application

<ul>
<li>Application loggint: <code>shinyapps::showLogs()</code></li>
<li>Configuring applications: <code>shinyapps::configureApp(APPNAME,size=&quot;small&quot;)</code></li>
<li>Application authentication(目前只有付費才有此功能)</li>
<li>Terminate an app: <code>terminateApp(&quot;&lt;your app&#39;s name&gt;&quot;)</code></li>
</ul></li>
</ul>

</article></slide><slide class=''><hgroup><h2>deploy shinyapps</h2></hgroup><article  id="deploy-shinyapps">

<ol>
<li>Login with Google or Github</li>
<li>get token: <code>setAccountInto(name,token,secret)</code></li>
<li><code>deployApp(appDir=&quot;appdir_name&quot;, appName = &quot;Name_at_shinyapps&quot;)</code></li>
</ol>

</article></slide><slide class=''><hgroup><h2>小挑戰11 &#8211; 將最後的app放到shinyapps</h2></hgroup><article  id="11----appshinyapps">

<p>Windows 需要較多更動，Mac與Linux只要資料位置正確即可直接deploy</p>

<ol>
<li>檔案放致在apps下面，與<code>ui.R</code>、<code>server.R</code>同目錄下<br/></li>
<li>將<code>load(&quot;ubikeweather_big5.rda&quot;)</code> 改成<code>load(&quot;ubikeweather_utf8.rda&quot;)</code><br/></li>
<li>download <a href='https://dl.dropboxusercontent.com/u/68133220/DSP/global.R' title=''>global.R</a> for 編碼支援<br/></li>
<li>程式內部除了註解不能放有中文字內容<br/></li>
<li>此部分所需時間較久，需要上傳資料與檔案，上課操作時網路流量要注意</li>
</ol>

</article></slide><slide class='segue dark nobackground'><hgroup class = 'auto-fadein'><h2>Appendiex</h2></hgroup><article  id="appendiex">

</article></slide><slide class=''><hgroup><h2>Layout</h2></hgroup><article  id="layout">

<p>通常指網頁版面，頁面的形式，佈局</p>

<ul>
<li>Sidebar Layouts(Simple default layout)</li>
<li>Grid Layouts

<ul>
<li>Custom application layouts: fluid &amp; fixed</li>
<li><code>fluidPage(fluidRow(column()))</code>

<ul>
<li>a flexibly sub-dividable 12-column grid for layout</li>
</ul></li>
</ul></li>
<li>Segmenting Layouts

<ul>
<li><code>navbarPage(tabPanel(), navbarMenu())</code></li>
<li><code>tabsetPanel(tabPanel()), navlistPanel(tabPanel())</code></li>
</ul></li>
<li>Responsive Layout

<ul>
<li>automatically adapt its layout for viewing on different sized devices</li>
</ul></li>
</ul>

</article></slide><slide class=''><hgroup><h2>Layout</h2></hgroup><article  id="layout-1">

<p><img src="img/Fluid.png" style='max-width: 100%;max-height:90%'> <img src="img/Responsive-Layout.png" style='max-width: 140%;max-height:60%'> <a href='http://goo.gl/x7fh2U' title=''>Responsive Layout</a></p></article></slide>


  <slide class="backdrop"></slide>

</slides>

<script src="Introduction-to-shiny_files/ioslides-13.5.1/js/modernizr.custom.45394.js"></script>
<script src="Introduction-to-shiny_files/ioslides-13.5.1/js/prettify/prettify.js"></script>
<script src="Introduction-to-shiny_files/ioslides-13.5.1/js/prettify/lang-r.js"></script>
<script src="Introduction-to-shiny_files/ioslides-13.5.1/js/prettify/lang-yaml.js"></script>
<script src="Introduction-to-shiny_files/ioslides-13.5.1/js/hammer.js"></script>
<script src="Introduction-to-shiny_files/ioslides-13.5.1/js/slide-controller.js"></script>
<script src="Introduction-to-shiny_files/ioslides-13.5.1/js/slide-deck.js"></script>

<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    script.src  = "https://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML";
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>

<!-- map slide visiblity events into shiny -->
<script>
  (function() {
    if (window.jQuery) {
       window.jQuery(document).on('slideleave', function(e) {
         window.jQuery(e.target).trigger('hidden');
      });
       window.jQuery(document).on('slideenter', function(e) {
         window.jQuery(e.target).trigger('shown');
      });
    }
  })();
</script>

</body>
</html>
